<!DOCTYPE html>
<html lang="en">
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Apply Now | PawnMe</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background: #0f172a; }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
  <div class="w-full max-w-2xl">
    <div class="bg-white rounded-2xl shadow-2xl overflow-hidden">
      <div class="p-6 md:p-8 border-b">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center text-white font-bold">P</div>
          <div>
            <div class="text-xl font-bold text-slate-900">PawnMe</div>
            <div class="text-sm text-slate-500">Loan Application</div>
          </div>
        </div>
      </div>

      <div class="p-6 md:p-8">
        <form id="appForm" class="space-y-4" onsubmit="submitApp(event)">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-xs font-bold text-slate-500 mb-1">Full Name</label>
              <input name="name" required class="w-full p-3 border rounded-xl" placeholder="John Doe" />
            </div>
            <div>
              <label class="block text-xs font-bold text-slate-500 mb-1">Email</label>
              <input name="email" type="email" required class="w-full p-3 border rounded-xl" placeholder="john@example.com" />
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-xs font-bold text-slate-500 mb-1">Phone</label>
              <input name="phone" required class="w-full p-3 border rounded-xl" placeholder="+234..." />
            </div>
            <div>
              <label class="block text-xs font-bold text-slate-500 mb-1">National ID</label>
              <input name="nationalId" required class="w-full p-3 border rounded-xl" placeholder="ID Number" />
            </div>
          </div>

          <div>
            <label class="block text-xs font-bold text-slate-500 mb-1">Address</label>
            <input name="address" required class="w-full p-3 border rounded-xl" placeholder="Street, City" />
          </div>

          <div>
            <label class="block text-xs font-bold text-slate-500 mb-1">Country</label>
            <input name="country" required class="w-full p-3 border rounded-xl" placeholder="Your country" />
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-xs font-bold text-slate-500 mb-1">Item Type</label>
              <input name="itemType" required class="w-full p-3 border rounded-xl" placeholder="Phone, Laptop, Gold..." />
            </div>
            <div>
              <label class="block text-xs font-bold text-slate-500 mb-1">Brand</label>
              <input name="brand" required class="w-full p-3 border rounded-xl" placeholder="Apple, Dell..." />
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-xs font-bold text-slate-500 mb-1">Serial (optional)</label>
              <input name="serial" class="w-full p-3 border rounded-xl" placeholder="Serial number" />
            </div>
            <div>
              <label class="block text-xs font-bold text-slate-500 mb-1">Condition</label>
              <input name="condition" required class="w-full p-3 border rounded-xl" placeholder="New, Used, Scratched..." />
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-xs font-bold text-slate-500 mb-1">Requested Amount (â‚º)</label>
              <input name="amount" type="number" min="0" required class="w-full p-3 border rounded-xl" placeholder="50000" />
            </div>
            <div>
              <label class="block text-xs font-bold text-slate-500 mb-1">Requested Duration (months)</label>
              <input name="duration" type="number" min="1" required class="w-full p-3 border rounded-xl" placeholder="3" />
            </div>
          </div>

          <div>
            <label class="block text-xs font-bold text-slate-500 mb-1">Collateral Image (optional)</label>
            <input id="collateralImage" name="collateralImage" type="file" accept="image/*" class="w-full p-3 border rounded-xl bg-white" />
            <div class="text-xs text-slate-500 mt-1">Upload a clear photo of the collateral item.</div>
          </div>

          <button id="btnSubmit" type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-xl">
            Submit Application
          </button>

          <div class="text-xs text-slate-500 text-center">
            After submission, a PawnMe manager will review and contact you.
          </div>
        </form>
      </div>
    </div>

    <div class="text-center text-xs text-slate-400 mt-6">
      Powered by PawnMe
    </div>
  </div>

  <script>
    function submitApp(event) {
      event.preventDefault();
      const btn = document.getElementById('btnSubmit');
      btn.disabled = true;
      btn.innerText = 'Submitting...';

      const formData = new FormData(document.getElementById('appForm'));
      const data = Object.fromEntries(formData);

      const fileInput = document.getElementById('collateralImage');
      const file = fileInput && fileInput.files && fileInput.files[0] ? fileInput.files[0] : null;

      const send = () => {
        google.script.run
          .withSuccessHandler(r => {
            if (r && r.success) {
              Swal.fire('Submitted', 'Your application has been received.', 'success');
              document.getElementById('appForm').reset();
            } else {
              Swal.fire('Error', (r && r.message) ? r.message : 'Submission failed', 'error');
            }
            btn.disabled = false;
            btn.innerText = 'Submit Application';
          })
          .withFailureHandler(err => {
            Swal.fire('Error', 'Submission failed: ' + err.message, 'error');
            btn.disabled = false;
            btn.innerText = 'Submit Application';
          })
          .submitApplication(data);
      };

      if (file) {
        const reader = new FileReader();
        reader.onload = () => {
          data.imageFile = reader.result;
          data.imageName = file.name;
          send();
        };
        reader.onerror = () => {
          btn.disabled = false;
          btn.innerText = 'Submit Application';
          Swal.fire('Error', 'Failed to read image file.', 'error');
        };
        reader.readAsDataURL(file);
        return;
      }

      send();
    }
  </script>
</body>
</html>
